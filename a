from flask import Flask, request
from linebot import LineBotApi, WebhookHandler
from linebot.exceptions import InvalidSignatureError
from linebot.models import MessageEvent, TextMessage, TextSendMessage
import os, random, json, threading, time
from datetime import datetime
from dotenv import load_dotenv

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

load_dotenv()
app = Flask(**name**)
LINE_CHANNEL_ACCESS_TOKEN = os.getenv(â€œLINE_CHANNEL_ACCESS_TOKENâ€)
LINE_CHANNEL_SECRET = os.getenv(â€œLINE_CHANNEL_SECRETâ€)
PORT = int(os.getenv(â€œPORTâ€, 5000))

line_bot_api = LineBotApi(LINE_CHANNEL_ACCESS_TOKEN)
handler = WebhookHandler(LINE_CHANNEL_SECRET)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DATA_FILE = â€œdata.jsonâ€
CONTENT_FILE = â€œcontent.jsonâ€
STATS_FILE = â€œstats.jsonâ€

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ø¯ÙˆØ§Ù„ ØªØ­Ù…ÙŠÙ„ ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def load_data():
â€œâ€â€œØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øªâ€â€â€
if not os.path.exists(DATA_FILE):
initial_data = {
â€œusersâ€: [],
â€œgroupsâ€: [],
â€œtasbihâ€: {},
â€œnotifications_offâ€: [],
â€œuser_preferencesâ€: {}  # âœ¨ Ø¬Ø¯ÙŠØ¯: ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
}
with open(DATA_FILE, â€œwâ€, encoding=â€œutf-8â€) as f:
json.dump(initial_data, f, ensure_ascii=False, indent=2)
return set(), set(), {}, set(), {}

```
with open(DATA_FILE, "r", encoding="utf-8") as f:
    data = json.load(f)
    return (
        set(data.get("users", [])),
        set(data.get("groups", [])),
        data.get("tasbih", {}),
        set(data.get("notifications_off", [])),
        data.get("user_preferences", {})
    )
```

def save_data():
â€œâ€â€œØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øªâ€â€â€
with open(DATA_FILE, â€œwâ€, encoding=â€œutf-8â€) as f:
json.dump({
â€œusersâ€: list(target_users),
â€œgroupsâ€: list(target_groups),
â€œtasbihâ€: tasbih_counts,
â€œnotifications_offâ€: list(notifications_off),
â€œuser_preferencesâ€: user_preferences
}, f, ensure_ascii=False, indent=2)

def load_stats():
â€œâ€â€œØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØªâ€â€â€
if not os.path.exists(STATS_FILE):
return {â€œtotal_messagesâ€: 0, â€œtotal_remindersâ€: 0, â€œdaily_active_usersâ€: {}}
with open(STATS_FILE, â€œrâ€, encoding=â€œutf-8â€) as f:
return json.load(f)

def save_stats():
â€œâ€â€œØ­ÙØ¸ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØªâ€â€â€
with open(STATS_FILE, â€œwâ€, encoding=â€œutf-8â€) as f:
json.dump(bot_stats, f, ensure_ascii=False, indent=2)

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

target_users, target_groups, tasbih_counts, notifications_off, user_preferences = load_data()
bot_stats = load_stats()

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

with open(CONTENT_FILE, â€œrâ€, encoding=â€œutf-8â€) as f:
content = json.load(f)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (Ù…ÙØ­Ø³Ù‘Ù†)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def send_random_message_to_all():
â€œâ€â€œØ¥Ø±Ø³Ø§Ù„ Ø°ÙƒØ±/Ø¯Ø¹Ø§Ø¡ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (Ù…Ø¹ Ø§Ø­ØªØ±Ø§Ù… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù)â€â€â€
category = random.choice([â€œduasâ€, â€œadhkarâ€, â€œhadithsâ€, â€œquranâ€])
message = random.choice(content.get(category, [â€œÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰â€]))

```
# âœ… Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
timestamp = datetime.now().strftime("%I:%M %p")
full_message = f"ğŸŒ™ {message}\n\nâ° {timestamp}"

sent_count = 0

# Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
for uid in target_users:
    if uid not in notifications_off:
        try:
            line_bot_api.push_message(uid, TextSendMessage(text=full_message))
            sent_count += 1
        except:
            pass

# Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
for gid in target_groups:
    if gid not in notifications_off:
        try:
            line_bot_api.push_message(gid, TextSendMessage(text=full_message))
            sent_count += 1
        except:
            pass

# âœ¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
bot_stats["total_reminders"] = bot_stats.get("total_reminders", 0) + sent_count
save_stats()
```

def scheduled_messages():
â€œâ€â€œÙ†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„â€â€â€
while True:
send_random_message_to_all()
# âœ¨ ÙˆÙ‚Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 4-5 Ø³Ø§Ø¹Ø§Øª (14400-18000 Ø«Ø§Ù†ÙŠØ©)
time.sleep(random.randint(14400, 18000))

# Ø¨Ø¯Ø¡ Ø®ÙŠØ· Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

threading.Thread(target=scheduled_messages, daemon=True).start()

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Webhook Routes

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@app.route(â€/â€, methods=[â€œGETâ€])
def home():
â€œâ€â€œØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©â€â€â€
return fâ€â€â€
<html>
<head><title>Islamic Bot Status</title></head>
<body style="font-family: Arial; text-align: center; padding: 50px;">
<h1>ğŸ¤– Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h1>
<p>ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: {len(target_users)}</p>
<p>ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª: {len(target_groups)}</p>
<p>âœ‰ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©: {bot_stats.get(â€˜total_remindersâ€™, 0)}</p>
</body>
</html>
â€œâ€â€, 200

@app.route(â€/callbackâ€, methods=[â€œPOSTâ€])
def callback():
â€œâ€â€œÙ…Ø¹Ø§Ù„Ø¬Ø© Webhook Ù…Ù† LINEâ€â€â€
signature = request.headers.get(â€œX-Line-Signatureâ€, â€œâ€)
body = request.get_data(as_text=True)
try:
handler.handle(body, signature)
except InvalidSignatureError:
pass
return â€œOKâ€, 200

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø²Ø¹Ø¬Ø©

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

links_count = {}
LINK_WARNING_THRESHOLD = 2

def handle_links(event, user_id):
â€œâ€â€œÙƒØ´Ù ÙˆÙ…Ù†Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©â€â€â€
try:
text = event.message.text.strip()
if any(keyword in text for keyword in [â€œhttp://â€, â€œhttps://â€, â€œwww.â€]):
links_count[user_id] = links_count.get(user_id, 0) + 1

```
        if links_count[user_id] >= LINK_WARNING_THRESHOLD:
            try:
                line_bot_api.reply_message(
                    event.reply_token,
                    TextSendMessage(text="âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø±ÙˆØ§Ø¨Ø·")
                )
            except:
                pass
        return True
except:
    pass
return False
```

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TASBIH_LIMIT = 33
TASBIH_TYPES = [â€œØ³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡â€, â€œØ§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡â€, â€œØ§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±â€, â€œØ§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡â€]

def ensure_user_counts(uid):
â€œâ€â€œØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ø¯Ø§Ø¯ ØªØ³Ø¨ÙŠØ­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…â€â€â€
if uid not in tasbih_counts:
tasbih_counts[uid] = {t: 0 for t in TASBIH_TYPES}

def reset_tasbih(uid):
â€œâ€â€œØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¨ÙŠØ­â€â€â€
tasbih_counts[uid] = {t: 0 for t in TASBIH_TYPES}
save_data()

def get_tasbih_progress(uid):
â€œâ€â€œØ¹Ø±Ø¶ ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ³Ø¨ÙŠØ­ Ù…Ø¹ Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù…â€â€â€
counts = tasbih_counts[uid]
progress_bar = â€œâ€

```
for tasbih_type in TASBIH_TYPES:
    count = counts[tasbih_type]
    percentage = (count / TASBIH_LIMIT) * 100
    filled = int(percentage / 10)
    bar = "â–“" * filled + "â–‘" * (10 - filled)
    progress_bar += f"{tasbih_type}: {count}/33\n{bar} {percentage:.0f}%\n\n"

return progress_bar.strip()
```

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
â€œâ€â€œÙ…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©â€â€â€
try:
user_text = event.message.text.strip()
user_id = event.source.user_id
gid = getattr(event.source, â€˜group_idâ€™, None)
first_time = False

```
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if user_id not in target_users:
        target_users.add(user_id)
        first_time = True

    if gid and gid not in target_groups:
        target_groups.add(gid)
        first_time = True

    save_data()
    ensure_user_counts(user_id)

    # âœ¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    bot_stats["total_messages"] = bot_stats.get("total_messages", 0) + 1
    today = datetime.now().strftime("%Y-%m-%d")
    daily_users = bot_stats.get("daily_active_users", {})
    daily_users[today] = daily_users.get(today, set())
    if isinstance(daily_users[today], list):
        daily_users[today] = set(daily_users[today])
    daily_users[today].add(user_id)
    bot_stats["daily_active_users"] = {k: list(v) if isinstance(v, set) else v for k, v in daily_users.items()}
    save_stats()

    # Ø¥Ø±Ø³Ø§Ù„ ØªØ±Ø­ÙŠØ¨ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
    if first_time:
        welcome_msg = "ğŸŒ™ Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\n\nÙ…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ!\n\nğŸ“Œ Ø§ÙƒØªØ¨ 'Ù…Ø³Ø§Ø¹Ø¯Ø©' Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆØ§Ù…Ø±"
        try:
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=welcome_msg))
        except:
            pass
        return

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #                    Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if handle_links(event, user_id):
        return

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #                   Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù†ØµÙŠØ©
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    # ğŸ“– Ø£Ù…Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    if user_text.lower() in ["Ù…Ø³Ø§Ø¹Ø¯Ø©", "help", "Ø§Ù„Ø£ÙˆØ§Ù…Ø±"]:
        help_text = """
```

ğŸŒ™ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ

ğŸ“¿ Ø§Ù„ØªØ³Ø¨ÙŠØ­:
â€¢ Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ / Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ / Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø± / Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡
â€¢ ØªØ³Ø¨ÙŠØ­ - Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯Ù…
â€¢ Ø¥Ø¹Ø§Ø¯Ø© - Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯

ğŸ“¨ Ø§Ù„ØªØ°ÙƒÙŠØ±:
â€¢ Ø°ÙƒØ±Ù†ÙŠ - Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø°ÙƒØ±/Ø¯Ø¹Ø§Ø¡ ÙÙˆØ±ÙŠ
â€¢ Ø¥ÙŠÙ‚Ø§Ù - Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
â€¢ ØªØ´ØºÙŠÙ„ - ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:
â€¢ Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ - Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ
â€¢ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª - Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙˆØª

â“ Ù…Ø³Ø§Ø¹Ø¯Ø© - Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ø§Ù‹ ğŸ’š
â€œâ€â€
try:
line_bot_api.reply_message(event.reply_token, TextSendMessage(text=help_text.strip()))
except:
pass
return

```
    # ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªØ³Ø¨ÙŠØ­ Ù…Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
    if user_text.lower() in ["ØªØ³Ø¨ÙŠØ­", "Ø¹Ø¯Ø§Ø¯", "Ø§Ù„ØªØ³Ø¨ÙŠØ­"]:
        progress = get_tasbih_progress(user_id)
        try:
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=f"ğŸ“¿ ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ³Ø¨ÙŠØ­:\n\n{progress}"))
        except:
            pass
        return

    # ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ³Ø¨ÙŠØ­
    if user_text.lower() in ["Ø¥Ø¹Ø§Ø¯Ø©", "reset", "Ø±ÙŠØ³Øª"]:
        reset_tasbih(user_id)
        try:
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text="âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¨ÙŠØ­"))
        except:
            pass
        return

    # ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if user_text.lower() in ["Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ", "Ø§Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ", "stats"]:
        counts = tasbih_counts[user_id]
        total = sum(counts.values())
        stats_text = f"""
```

ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©:

ğŸ“¿ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø¨ÙŠØ­Ø§Øª: {total}
Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡: {counts[â€˜Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡â€™]}
Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡: {counts[â€˜Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡â€™]}
Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±: {counts[â€˜Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±â€™]}
Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡: {counts[â€˜Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡â€™]}

ğŸ¯ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: {sum(1 for c in counts.values() if c >= TASBIH_LIMIT)}/4
â€œâ€â€
try:
line_bot_api.reply_message(event.reply_token, TextSendMessage(text=stats_text.strip()))
except:
pass
return

```
    # ğŸ¤– Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
    if user_text.lower() in ["Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª", "Ø§Ù„Ø­Ø§Ù„Ø©", "status"]:
        status_text = f"""
```

ğŸ¤– Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª:

ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: {len(target_users)}
ğŸ˜ï¸ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª: {len(target_groups)}
âœ‰ï¸ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©: {bot_stats.get(â€˜total_remindersâ€™, 0)}
ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: {bot_stats.get(â€˜total_messagesâ€™, 0)}
ğŸŸ¢ Ø§Ù„Ø­Ø§Ù„Ø©: ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­
â€œâ€â€
try:
line_bot_api.reply_message(event.reply_token, TextSendMessage(text=status_text.strip()))
except:
pass
return

```
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #                  Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¨ÙŠØ­ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    clean_text = user_text.replace(" ", "")
    key_map = {
        "Ø³Ø¨Ø­Ø§Ù†Ø§Ù„Ù„Ù‡": "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡",
        "Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡": "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡",
        "Ø§Ù„Ù„Ù‡Ø£ÙƒØ¨Ø±": "Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±",
        "Ø§Ø³ØªØºÙØ±Ø§Ù„Ù„Ù‡": "Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡"
    }
    
    key = key_map.get(clean_text)
    if key:
        if tasbih_counts[user_id][key] < TASBIH_LIMIT:
            tasbih_counts[user_id][key] += 1
            save_data()

        # Ø¥Ø´Ø¹Ø§Ø± Ø§ÙƒØªÙ…Ø§Ù„ Ø°ÙƒØ± ÙˆØ§Ø­Ø¯
        if tasbih_counts[user_id][key] == TASBIH_LIMIT:
            try:
                line_bot_api.push_message(
                    user_id,
                    TextSendMessage(text=f"âœ¨ Ù…Ø§Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ø§ÙƒØªÙ…Ù„Øª {key} 33 Ù…Ø±Ø©!")
                )
            except:
                pass

        # Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯Ù…
        progress = get_tasbih_progress(user_id)
        try:
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=f"ğŸ“¿ {progress}"))
        except:
            pass

        # Ø¥Ø´Ø¹Ø§Ø± Ø§ÙƒØªÙ…Ø§Ù„ ÙƒÙ„ Ø§Ù„Ø£Ø°ÙƒØ§Ø±
        counts = tasbih_counts[user_id]
        if all(counts[k] >= TASBIH_LIMIT for k in TASBIH_TYPES):
            try:
                line_bot_api.push_message(
                    user_id,
                    TextSendMessage(text="ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø§ÙƒØªÙ…Ù„Øª ÙƒÙ„ Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©!\n\nØ¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ø§Ù‹\nÙˆØ¬Ø¹Ù„ Ø§Ù„Ù„Ù‡ Ù„Ùƒ ÙˆÙ„ÙˆØ§Ù„Ø¯ÙŠÙƒ Ø§Ù„Ø¬Ù†Ø© ğŸ’š")
                )
            except:
                pass
        return

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #              Ø£Ù…Ø± Ø°ÙƒØ±Ù†ÙŠ (Ù„Ù„Ù…Ø±Ø³Ù„ ÙÙ‚Ø·)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if user_text.lower() in ["Ø°ÙƒØ±Ù†ÙŠ", "ØªØ°ÙƒÙŠØ±", "Ø°ÙƒØ±"]:
        category = random.choice(["duas", "adhkar", "hadiths", "quran"])
        message = random.choice(content.get(category, ["Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰"]))
        
        timestamp = datetime.now().strftime("%I:%M %p")
        full_message = f"ğŸŒ™ {message}\n\nâ° {timestamp}"
        
        try:
            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=full_message))
        except:
            pass
        return

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #              Ø¥ÙŠÙ‚Ø§Ù/ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if user_text.lower() in ["Ø¥ÙŠÙ‚Ø§Ù", "stop", "Ø§ÙŠÙ‚Ø§Ù"]:
        target_id = gid if gid else user_id
        notifications_off.add(target_id)
        save_data()
        try:
            line_bot_api.reply_message(
                event.reply_token,
                TextSendMessage(text="âœ… ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ\n\nÙ„ØªØ´ØºÙŠÙ„Ù‡ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§ÙƒØªØ¨: ØªØ´ØºÙŠÙ„")
            )
        except:
            pass
        return

    if user_text.lower() in ["ØªØ´ØºÙŠÙ„", "start", "Ø¨Ø¯Ø¡"]:
        target_id = gid if gid else user_id
        if target_id in notifications_off:
            notifications_off.remove(target_id)
            save_data()
        try:
            line_bot_api.reply_message(
                event.reply_token,
                TextSendMessage(text="âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ\n\nØ³ØªØµÙ„Ùƒ Ø±Ø³Ø§Ø¦Ù„ ÙƒÙ„ 4-5 Ø³Ø§Ø¹Ø§Øª ğŸŒ™")
            )
        except:
            pass
        return

except Exception as e:
    print(f"Error in handle_message: {e}")
    pass
```

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if **name** == â€œ**main**â€:
print(â€œğŸš€ Ø§Ù„Ø¨ÙˆØª Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!â€)
print(fâ€ğŸ“Š Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†: {len(target_users)}â€)
print(fâ€ğŸ‘¥ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: {len(target_groups)}â€)
app.run(host=â€œ0.0.0.0â€, port=PORT)
